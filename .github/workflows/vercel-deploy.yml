name: Vercel Deployment with Webhook Approval

on:
  push:
    branches: [ main ]

jobs:
  notify-approvers:
    runs-on: ubuntu-latest
    steps:
      - name: Send Approval Requests
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: ${{ secrets.SMTP_SERVER }}
          server_port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "ðŸ”„ Deployment Approval Required - ${{ github.repository }}"
          body: |
            A new deployment requires your approval.

            Repository: ${{ github.repository }}
            Branch: ${{ github.ref_name }}
            Commit: ${{ github.sha }}
            Triggered by: ${{ github.actor }}

            Review changes: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}

            To approve the deployment, please send a POST request to the custom webhook (or trigger a dispatch event).
            Example cURL command:

            curl -X POST -H "Authorization: token <GITHUB_PAT>" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/${{ github.repository }}/dispatches \
            -d '{"event_type":"vercel-approve-deploy","client_payload":{"commit_sha":"${{ github.sha }}"}}'

          to: ${{ secrets.APPROVER_EMAIL_1 }},${{ secrets.APPROVER_EMAIL_2 }}
          from: "GitHub Actions <${{ secrets.SMTP_USERNAME }}>"



